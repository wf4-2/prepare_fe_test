<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React Quiz</title>
    <link rel="stylesheet" href="index.css" />
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="./questions.js"></script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      function App() {
        const [currentQuestionIndex, setCurrentQuestionIndex] =
          React.useState(0);
        const [selectedOption, setSelectedOption] = React.useState(null);
        const [isAnswerChecked, setIsAnswerChecked] = React.useState(false);
        const [isDarkMode, setIsDarkMode] = React.useState(() => {
          // Check system preference on initial load
          return (
            window.matchMedia &&
            window.matchMedia('(prefers-color-scheme: dark)').matches
          );
        });

        // Apply initial dark mode class based on system preference
        React.useEffect(() => {
          if (isDarkMode) {
            document.body.classList.add('dark-mode');
          } else {
            document.body.classList.remove('dark-mode');
          }
        }, [isDarkMode]);

        const currentQuestion = questions[currentQuestionIndex];

        const handleOptionSelect = (index) => {
          if (!isAnswerChecked) {
            setSelectedOption(index);
          }
        };

        const checkAnswer = () => {
          setIsAnswerChecked(true);
        };

        const nextQuestion = () => {
          if (currentQuestionIndex < questions.length - 1) {
            setCurrentQuestionIndex(currentQuestionIndex + 1);
            setSelectedOption(null);
            setIsAnswerChecked(false);
          }
        };

        const toggleDarkMode = () => {
          setIsDarkMode(!isDarkMode);
          document.body.classList.toggle('dark-mode');
        };

        const isCorrectAnswer = selectedOption === currentQuestion.answer;

        return (
          <div className={`quiz-container ${isDarkMode ? 'dark-mode' : ''}`}>
            <div className='dark-mode-toggle' onClick={toggleDarkMode}>
              {isDarkMode ? '☀️' : '🌙'}
            </div>
            <h2>React Quiz</h2>
            <div className='question-info'>
              <span>
                문제 {currentQuestionIndex + 1} / {questions.length}
              </span>
              <span>분류: {currentQuestion.category}</span>
            </div>
            <div className='question'>{currentQuestion.question}</div>
            <div className='options'>
              {currentQuestion.options.map((option, index) => (
                <div
                  key={index}
                  className={`option 
                                    ${
                                      selectedOption === index ? 'selected' : ''
                                    } 
                                    ${
                                      isAnswerChecked &&
                                      index === currentQuestion.answer
                                        ? 'correct'
                                        : ''
                                    } 
                                    ${
                                      isAnswerChecked &&
                                      selectedOption === index &&
                                      !isCorrectAnswer
                                        ? 'incorrect'
                                        : ''
                                    }`}
                  onClick={() => handleOptionSelect(index)}
                >
                  {isAnswerChecked && index === currentQuestion.answer && '✓ '}
                  {isAnswerChecked &&
                    selectedOption === index &&
                    !isCorrectAnswer &&
                    '✗ '}
                  {option}
                </div>
              ))}
            </div>
            {!isAnswerChecked && selectedOption !== null && (
              <button onClick={checkAnswer}>정답 확인</button>
            )}
            {isAnswerChecked && (
              <div
                className={`result ${
                  isCorrectAnswer ? 'correct' : 'incorrect'
                }`}
              >
                {isCorrectAnswer ? '정답입니다!' : '틀렸습니다.'}
              </div>
            )}
            {isAnswerChecked && currentQuestionIndex < questions.length - 1 && (
              <button onClick={nextQuestion}>다음 문제</button>
            )}
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
